{% extends "customer_portal/base.html" %}
{% from "_macros/ui.html" import metric_card, button_primary, button_secondary, card, empty_state %}

{% block page_title %}Dashboard{% endblock %}

{% block customer_content %}
{# Welcome Section #}
<div class="flex flex-col gap-6 rounded-2xl border border-slate-800/70 bg-slate-900/70 p-6 shadow-lg shadow-slate-950/40 ring-1 ring-white/5">
  <div class="flex items-center gap-4">
    <div class="flex h-16 w-16 items-center justify-center rounded-full bg-gradient-to-br from-emerald-500 to-sky-500 text-2xl font-bold text-white shadow-lg">
      {{ customer.first_name[0] if customer and customer.first_name else '?' }}
    </div>
    <div>
      <h1 class="text-2xl font-semibold tracking-tight text-slate-100">Welcome back, {{ customer.first_name if customer else 'Guest' }}!</h1>
      <p class="text-sm text-slate-400">Here's an overview of your jobs with {{ config.BRANDING_COMPANY_NAME or 'Victoria Powder Coating' }}</p>
    </div>
  </div>
</div>

{# Job Statistics #}
<dl class="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
  {{ metric_card("Total Jobs", stats.total or 0, color="blue") }}
  {{ metric_card("In Progress", stats.pending or 0, color="amber") }}
  {{ metric_card("Completed", stats.completed or 0, color="green") }}
  {{ metric_card("Overdue", stats.overdue or 0, color="red") }}
</dl>

{# Recent Jobs #}
<div class="rounded-2xl border border-slate-800/70 bg-slate-900/70 shadow-lg shadow-slate-950/30">
  <div class="flex flex-wrap items-center justify-between gap-4 border-b border-slate-800 p-6">
    <h2 class="text-xl font-semibold text-slate-100">Recent Jobs</h2>
    {{ button_primary("View All Jobs", href=url_for('customer_portal.jobs_list')) }}
  </div>
  <div class="p-6">
    {% if jobs %}
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-slate-800">
          <thead>
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Job #</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Date</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Description</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Status</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Due Date</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-800">
            {% for job in jobs[:5] %}
            <tr class="hover:bg-slate-800/50 transition-colors">
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-100">#{{ job.id }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-300">{{ job.created_at[:10] if job.created_at else 'N/A' }}</td>
              <td class="px-6 py-4 text-sm text-slate-300">{{ job.description[:50] if job.description else 'No description' }}{{ '...' if job.description and job.description|length > 50 else '' }}</td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="inline-flex px-3 py-1 text-xs font-semibold rounded-full
                  {% if job.status == 'Completed' %}bg-green-500/20 text-green-300 border border-green-500/30
                  {% elif job.status == 'Ready for Pickup' %}bg-blue-500/20 text-blue-300 border border-blue-500/30
                  {% elif job.status == 'In Progress' %}bg-yellow-500/20 text-yellow-300 border border-yellow-500/30
                  {% elif job.status == 'Not Started' %}bg-slate-500/20 text-slate-300 border border-slate-500/30
                  {% else %}bg-blue-500/20 text-blue-300 border border-blue-500/30{% endif %}">
                  {{ job.status }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-300">{{ job.due_by if job.due_by else 'No due date' }}</td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <a href="{{ url_for('customer_portal.job_detail', job_id=job.id) }}"
                   class="px-3 py-1 bg-slate-700 hover:bg-blue-600 text-slate-200 hover:text-white text-xs font-medium rounded-lg transition-all duration-200 hover:shadow-md">
                  View
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      {% call empty_state("No jobs yet", "You haven't submitted any jobs yet. Get started by creating your first job!") %}
        <svg class="h-12 w-12 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
        </svg>
        <div class="actions">
          {{ button_primary("Production Intake", href=url_for('intake.intake_form')) }}
          {{ button_secondary("Railing Intake", href=url_for('intake.railing_intake')) }}
        </div>
      {% endcall %}
    {% endif %}
  </div>
</div>

{# Quick Actions #}
{% if jobs %}
<div class="rounded-2xl border border-slate-800/70 bg-slate-900/70 shadow-lg shadow-slate-950/30">
  <div class="border-b border-slate-800 p-6">
    <h2 class="text-xl font-semibold text-slate-100">Quick Actions</h2>
    <p class="mt-1 text-sm text-slate-400">Common tasks and shortcuts</p>
  </div>
  <div class="p-6">
    <div class="grid gap-4 md:grid-cols-2">
      {% call card() %}
        <div class="flex items-center gap-3 text-slate-200">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
          </svg>
          <span class="font-medium">Production Intake Form</span>
        </div>
        {{ button_primary("Submit Job", href=url_for('intake.intake_form')) }}
      {% endcall %}
      
      {% call card() %}
        <div class="flex items-center gap-3 text-slate-200">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
          </svg>
          <span class="font-medium">Railing Intake Form</span>
        </div>
        {{ button_secondary("Submit Railing Job", href=url_for('intake.railing_intake')) }}
      {% endcall %}
      
      {% call card() %}
        <div class="flex items-center gap-3 text-slate-200">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
          </svg>
          <span class="font-medium">View All Jobs</span>
        </div>
        {{ button_secondary("Go to Jobs", href=url_for('customer_portal.jobs_list')) }}
      {% endcall %}
      
      {% call card() %}
        <div class="flex items-center gap-3 text-slate-200">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          <span class="font-medium">Update Profile</span>
        </div>
        {{ button_secondary("Edit Profile", href=url_for('customer_portal.profile')) }}
      {% endcall %}
    </div>
  </div>
</div>
{% endif %}
{% endblock %}

