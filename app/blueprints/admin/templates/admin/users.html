{% extends "_layouts/base.html" %}
{% block title %}Admin Users{% endblock %}
{% block content %}
<section class="space-y-8">
  <header class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-semibold tracking-tight text-slate-100">Admin Users</h1>
      <p class="text-sm text-slate-400">Manage users with access to the back office</p>
    </div>
  </header>

  <div class="rounded-2xl border border-slate-800/70 bg-slate-900/70 p-6 shadow-lg">
    <h2 class="text-lg font-semibold mb-4">Create User</h2>
    <form method="POST" action="{{ url_for('admin.users_create') }}" class="grid gap-3 md:grid-cols-3">
      {% if csrf_token is defined %}<input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />{% endif %}
      <div>
        <label class="block text-sm mb-1" for="username">Username</label>
        <input id="username" name="username" class="w-full px-3 py-2 rounded-lg bg-slate-950/70 border border-slate-800" required />
      </div>
      <div>
        <label class="block text-sm mb-1" for="password">Password</label>
        <input id="password" type="password" name="password" class="w-full px-3 py-2 rounded-lg bg-slate-950/70 border border-slate-800" required />
      </div>
      <div class="flex items-end gap-4">
        <label class="inline-flex items-center gap-2 text-sm text-slate-300"><input type="checkbox" name="is_admin" /> Admin</label>
        <button class="rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white hover:bg-emerald-500">Create</button>
      </div>
    </form>
  </div>

  <div class="rounded-2xl border border-slate-800/70 bg-slate-900/70 p-6 shadow-lg">
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead class="bg-slate-900/70">
          <tr>
            <th class="text-left px-4 py-2">Username</th>
            <th class="text-left px-4 py-2">Admin</th>
            <th class="text-left px-4 py-2">Created</th>
            <th class="text-left px-4 py-2">Permissions</th>
            <th class="text-left px-4 py-2">Save</th>
          </tr>
        </thead>
        <tbody>
          {% for u in users %}
          <tr class="border-t border-slate-800/70">
            <form method="POST" action="{{ url_for('admin.users_save', user_id=u.id) }}">
              {% if csrf_token is defined %}<input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />{% endif %}
              <td class="px-4 py-2 align-top">
                <div class="font-medium">{{ u.username }}</div>
                <div class="text-xs text-slate-400">ID: {{ u.id }}</div>
              </td>
              <td class="px-4 py-2 align-top"><input type="checkbox" name="is_admin" {% if u.is_admin %}checked{% endif %} /></td>
              <td class="px-4 py-2 align-top">{{ (u.created_at|string)[:19] if u.created_at else '-' }}</td>
              <td class="px-4 py-2 align-top">
                {% set p = (u.permissions_json or {}).get('perms', []) %}
                <div class="grid grid-cols-2 gap-2 text-xs">
                  <label class="inline-flex items-center gap-2"><input type="checkbox" name="see_jobs" {% if 'see_jobs' in p %}checked{% endif %}/> see_jobs</label>
                  <label class="inline-flex items-center gap-2"><input type="checkbox" name="see_powders" {% if 'see_powders' in p %}checked{% endif %}/> see_powders</label>
                  <label class="inline-flex items-center gap-2"><input type="checkbox" name="see_inventory" {% if 'see_inventory' in p %}checked{% endif %}/> see_inventory</label>
                  <label class="inline-flex items-center gap-2"><input type="checkbox" name="edit_options" {% if 'edit_options' in p %}checked{% endif %}/> edit_options</label>
                  <label class="inline-flex items-center gap-2"><input type="checkbox" name="manage_users" {% if 'manage_users' in p %}checked{% endif %}/> manage_users</label>
                </div>
              </td>
              <td class="px-4 py-2 align-top">
                <button class="rounded-md bg-slate-800 px-3 py-1 hover:bg-slate-700">Save</button>
              </td>
            </form>
          </tr>
          {% else %}
          <tr>
            <td colspan="3" class="px-4 py-6 text-slate-400">No users found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>
{% endblock %}

