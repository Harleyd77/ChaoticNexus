{% extends "_layouts/base.html" %}

{% block title %}Jobs{% endblock %}

{% block content %}
<section class="space-y-8">
  <header class="flex flex-col gap-6 rounded-2xl border border-slate-800/70 bg-slate-900/70 p-6 shadow-lg shadow-slate-950/40 ring-1 ring-white/5">
    <div class="flex flex-wrap items-center justify-between gap-4">
      <div>
        <h1 class="text-2xl font-semibold tracking-tight text-slate-100">Jobs</h1>
        <p class="text-sm text-slate-400">
          Track production progress, assignments, and customer details for every active work order.
        </p>
      </div>
      <div class="flex flex-wrap items-center gap-3">
        <button
          type="button"
          class="inline-flex items-center gap-2 rounded-lg border border-transparent bg-emerald-500 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-emerald-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300"
          data-pending-route
          data-pending-target="/jobs/create"
        >
          New Job
        </button>
        <button
          type="button"
          class="inline-flex items-center gap-2 rounded-lg border border-slate-700/70 bg-slate-800/70 px-4 py-2 text-sm font-medium text-slate-200 shadow-sm transition hover:border-slate-500 hover:bg-slate-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-slate-300"
          data-pending-route
          data-pending-target="/jobs/export"
        >
          Export CSV
        </button>
      </div>
    </div>

    <dl class="grid gap-4 md:grid-cols-3">
      <div class="rounded-xl border border-emerald-500/20 bg-emerald-500/10 p-4 text-emerald-200">
        <dt class="text-xs font-semibold uppercase tracking-[0.26em] text-emerald-300/80">Active Jobs</dt>
        <dd class="mt-2 text-2xl font-semibold">{{ metrics.active }}</dd>
      </div>
      <div class="rounded-xl border border-amber-500/20 bg-amber-500/10 p-4 text-amber-200">
        <dt class="text-xs font-semibold uppercase tracking-[0.26em] text-amber-300/80">Due Today</dt>
        <dd class="mt-2 text-2xl font-semibold">{{ metrics.due_today }}</dd>
      </div>
      <div class="rounded-xl border border-sky-500/20 bg-sky-500/10 p-4 text-sky-200">
        <dt class="text-xs font-semibold uppercase tracking-[0.26em] text-sky-300/80">Awaiting Pickup</dt>
        <dd class="mt-2 text-2xl font-semibold">{{ metrics.awaiting_pickup }}</dd>
      </div>
    </dl>

    <form class="flex flex-wrap items-center gap-3" role="search">
      <label class="flex min-w-[240px] flex-1 items-center gap-2 rounded-lg border border-slate-800 bg-slate-950/70 px-3 py-2 text-sm text-slate-200 focus-within:border-slate-500 focus-within:ring-2 focus-within:ring-slate-500/40">
        <span class="text-slate-500">@</span>
        <input
          class="w-full bg-transparent text-sm text-slate-100 placeholder:text-slate-500 focus:outline-none"
          type="search"
          name="q"
          placeholder="Search by customer, job id, coating..."
          value="{{ filters.query }}"
          data-pending-route
          data-pending-target="/jobs/search"
        />
      </label>
      <label class="flex items-center gap-2 rounded-lg border border-slate-800 bg-slate-950/70 px-3 py-2 text-sm text-slate-200 focus-within:border-slate-500 focus-within:ring-2 focus-within:ring-slate-500/40">
        <span class="text-slate-500">Stage</span>
        <select
          class="bg-transparent text-sm text-slate-100 focus:outline-none"
          name="stage"
          data-pending-route
          data-pending-target="/jobs/filter"
        >
          <option value="all" {% if filters.stage == "all" %}selected{% endif %}>All</option>
          <option value="prep" {% if filters.stage == "prep" %}selected{% endif %}>In Prep</option>
          <option value="queue" {% if filters.stage == "queue" %}selected{% endif %}>Queued</option>
          <option value="qa" {% if filters.stage == "qa" %}selected{% endif %}>Quality Review</option>
          <option value="completed" {% if filters.stage == "completed" %}selected{% endif %}>Completed</option>
        </select>
      </label>
      <label class="inline-flex items-center gap-2 rounded-lg border border-slate-800 bg-slate-950/70 px-3 py-2 text-sm text-slate-200">
        <input type="checkbox" class="h-4 w-4 rounded border-slate-700 bg-slate-900 text-emerald-500 focus:ring-emerald-400" {% if filters.show_archived %}checked{% endif %} data-pending-route data-pending-target="/jobs/archived" />
        <span>Show archived</span>
      </label>
    </form>
  </header>

  <section class="space-y-4">
    <div class="flex items-center justify-between">
      <h2 class="text-sm font-semibold uppercase tracking-[0.3em] text-slate-400">Current Jobs</h2>
      <span class="text-xs text-slate-500">Routes marked ‚ÄúSoon‚Äù are pending migration.</span>
    </div>

    <div class="grid gap-4">
      {% for job in jobs %}
        <article class="rounded-2xl border border-slate-800/70 bg-slate-900/70 p-6 shadow-lg shadow-slate-950/30 transition hover:border-slate-600 hover:shadow-slate-950/50">
          <header class="flex flex-wrap items-start justify-between gap-3">
            <div>
              <h3 class="text-lg font-semibold text-slate-100">
                <span>{{ job.customer }}</span>
                <span class="ml-2 text-sm font-normal text-slate-400">{{ job.reference }}</span>
              </h3>
              <p class="text-sm text-slate-400">
                Job <span class="font-semibold text-slate-200">#{{ job.id }}</span> ‚Ä¢ {{ job.status }}
              </p>
            </div>
            <div class="flex flex-wrap items-center gap-2 text-xs">
              {% if job.has_photos %}
                <span class="inline-flex items-center gap-1 rounded-full border border-sky-500/30 bg-sky-500/10 px-3 py-1 text-sky-200">
                  <span aria-hidden="true">üì∑</span> Photos
                </span>
              {% endif %}
              <span class="inline-flex items-center gap-1 rounded-full border border-slate-700 bg-slate-800/80 px-3 py-1 text-slate-300">
                Due {{ job.due }}
              </span>
            </div>
          </header>

          <dl class="mt-4 grid gap-3 md:grid-cols-3">
            <div>
              <dt class="text-xs font-semibold uppercase tracking-[0.25em] text-slate-500">Coating</dt>
              <dd class="mt-1 text-sm font-medium text-slate-200">{{ job.coating }}</dd>
            </div>
            <div>
              <dt class="text-xs font-semibold uppercase tracking-[0.25em] text-slate-500">Next Step</dt>
              <dd class="mt-1 text-sm font-medium text-slate-200">{{ job.next_step }}</dd>
            </div>
            <div>
              <dt class="text-xs font-semibold uppercase tracking-[0.25em] text-slate-500">Status</dt>
              <dd class="mt-1 text-sm font-medium text-slate-200">{{ job.status }}</dd>
            </div>
          </dl>

          <p class="mt-4 text-sm leading-6 text-slate-300">
            {{ job.notes }}
          </p>

          <footer class="mt-6 flex flex-wrap items-center gap-3">
            <a
              href="{{ url_for('jobs.detail', job_id=job.id) }}"
              class="inline-flex items-center gap-2 rounded-lg border border-transparent bg-emerald-500 px-4 py-2 text-sm font-semibold text-white transition hover:bg-emerald-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-300"
            >
              View Details
            </a>
            <a
              href="/jobs/{{ job.id }}/edit"
              class="inline-flex items-center gap-2 rounded-lg border border-slate-700/70 bg-slate-800/70 px-4 py-2 text-sm font-medium text-slate-200 transition hover:border-slate-500 hover:bg-slate-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-slate-300"
              data-pending-route
              data-pending-target="/jobs/{{ job.id }}/edit"
            >
              Edit Job
            </a>
            <button
              type="button"
              class="inline-flex items-center gap-2 rounded-lg border border-slate-700/70 bg-slate-800/70 px-4 py-2 text-sm font-medium text-slate-200 transition hover:border-slate-500 hover:bg-slate-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-slate-300"
              data-pending-route
              data-pending-target="/jobs/{{ job.id }}/batch"
            >
              Add to Batch
            </button>
          </footer>
        </article>
      {% else %}
        <div class="rounded-2xl border border-slate-800/60 bg-slate-900/60 p-8 text-center text-slate-400">
          No jobs match your filters yet.
        </div>
      {% endfor %}
    </div>
  </section>
</section>
{% endblock %}
