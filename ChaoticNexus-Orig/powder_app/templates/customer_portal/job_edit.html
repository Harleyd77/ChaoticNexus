{% extends "customer_portal/base.html" %}

{% block title %}Edit Job #{{ job.id }}{% endblock %}

{% block content %}
<div class="row mb-4">
  <div class="col">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ url_for('customer_portal.dashboard') }}">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="{{ url_for('customer_portal.jobs_list') }}">My Jobs</a></li>
        <li class="breadcrumb-item"><a href="{{ url_for('customer_portal.job_detail', job_id=job.id) }}">Job #{{ job.id }}</a></li>
        <li class="breadcrumb-item active">Edit</li>
      </ol>
    </nav>
  </div>
</div>

<div class="row justify-content-center">
  <div class="col-lg-8">
    <div class="card bg-secondary">
      <div class="card-header">
        <h4 class="card-title mb-0">Edit Job #{{ job.id }}</h4>
        <p class="text-muted mb-0">Current Status: <strong>{{ job.status }}</strong></p>
      </div>
      <div class="card-body">
        <form method="POST">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="contact_name" class="form-label">Contact Name *</label>
              <input type="text" class="form-control" id="contact_name" name="contact_name"
                     value="{{ job.contact_name or '' }}" required>
            </div>
            <div class="col-md-6 mb-3">
              <label for="company" class="form-label">Company *</label>
              <input type="text" class="form-control" id="company" name="company"
                     value="{{ job.company or '' }}" required>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="phone" class="form-label">Phone Number</label>
              <input type="tel" class="form-control" id="phone" name="phone"
                     value="{{ job.phone or '' }}">
            </div>
            <div class="col-md-6 mb-3">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email" name="email"
                     value="{{ job.email or '' }}">
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="po" class="form-label">PO Number</label>
              <input type="text" class="form-control" id="po" name="po"
                     value="{{ job.po or '' }}">
            </div>
            <div class="col-md-6 mb-3">
              <label for="type" class="form-label">Job Type *</label>
              <select class="form-select" id="type" name="type" required>
                <option value="">Select job type...</option>
                <option value="Powder Coating" {{ 'selected' if job.type == 'Powder Coating' else '' }}>Powder Coating</option>
                <option value="Sandblasting" {{ 'selected' if job.type == 'Sandblasting' else '' }}>Sandblasting</option>
                <option value="Painting" {{ 'selected' if job.type == 'Painting' else '' }}>Painting</option>
                <option value="Restoration" {{ 'selected' if job.type == 'Restoration' else '' }}>Restoration</option>
                <option value="Custom" {{ 'selected' if job.type == 'Custom' else '' }}>Custom Work</option>
                <option value="Repair" {{ 'selected' if job.type == 'Repair' else '' }}>Repair</option>
              </select>
            </div>
          </div>

          <div class="mb-3">
            <label for="priority" class="form-label">Priority</label>
            <select class="form-select" id="priority" name="priority">
              <option value="Normal" {{ 'selected' if job.priority == 'Normal' else '' }}>Normal</option>
              <option value="Rush" {{ 'selected' if job.priority == 'Rush' else '' }}>Rush (+50%)</option>
              <option value="Emergency" {{ 'selected' if job.priority == 'Emergency' else '' }}>Emergency (+100%)</option>
            </select>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="blast" class="form-label">Blasting Required?</label>
              <select class="form-select" id="blast" name="blast">
                <option value="">Not specified</option>
                <option value="Light" {{ 'selected' if job.blast == 'Light' else '' }}>Light Blasting</option>
                <option value="Medium" {{ 'selected' if job.blast == 'Medium' else '' }}>Medium Blasting</option>
                <option value="Heavy" {{ 'selected' if job.blast == 'Heavy' else '' }}>Heavy Blasting</option>
                <option value="None" {{ 'selected' if job.blast == 'None' else '' }}>No Blasting</option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label for="prep" class="form-label">Surface Preparation</label>
              <select class="form-select" id="prep" name="prep">
                <option value="">Not specified</option>
                <option value="Wash" {{ 'selected' if job.prep == 'Wash' else '' }}>Wash Only</option>
                <option value="Light Sand" {{ 'selected' if job.prep == 'Light Sand' else '' }}>Light Sanding</option>
                <option value="Heavy Sand" {{ 'selected' if job.prep == 'Heavy Sand' else '' }}>Heavy Sanding</option>
                <option value="Chemical Strip" {{ 'selected' if job.prep == 'Chemical Strip' else '' }}>Chemical Strip</option>
                <option value="Media Blast" {{ 'selected' if job.prep == 'Media Blast' else '' }}>Media Blast</option>
              </select>
            </div>
          </div>

          <div class="mb-3">
            <label for="color" class="form-label">Color/Finish</label>
            <input type="text" class="form-control" id="color" name="color"
                   value="{{ job.color or '' }}"
                   placeholder="e.g., Gloss Black, RAL 9005, Custom Match">
          </div>

          <div class="mb-3">
            <label for="description" class="form-label">Job Description *</label>
            <textarea class="form-control" id="description" name="description"
                      rows="4" required>{{ job.description or '' }}</textarea>
          </div>

          <div class="mb-3">
            <label for="notes" class="form-label">Additional Notes</label>
            <textarea class="form-control" id="notes" name="notes"
                      rows="3">{{ job.notes or '' }}</textarea>
          </div>

          <div class="mb-3">
            <label for="due_by" class="form-label">Preferred Completion Date</label>
            <input type="date" class="form-control" id="due_by" name="due_by"
                   value="{{ job.due_by or '' }}">
            <div class="form-text">Leave blank if no specific deadline</div>
          </div>

          <div class="mb-3">
            <label for="change_reason" class="form-label">Reason for Changes</label>
            <textarea class="form-control" id="change_reason" name="change_reason"
                      rows="2" placeholder="Briefly explain what changes you're making and why"></textarea>
            <div class="form-text">This helps us understand your requirements better</div>
          </div>

          <div class="alert alert-warning">
            <strong>Note:</strong> After editing, your job will need to be re-approved by our team if it was previously approved.
          </div>

          <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <a href="{{ url_for('customer_portal.job_detail', job_id=job.id) }}"
               class="btn btn-secondary me-md-2">Cancel</a>
            <button type="submit" class="btn btn-primary">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}
